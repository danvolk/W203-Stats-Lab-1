---
title: "W203 Statistics - Lab 1"
author: "Justine Heritage, Morris Burkhardt, Daniel Volk"
date: "May 31, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

This analysis is motivated by the following research question:

> What is the relationship between CEO salary and company performance?

Our data was provided with the following codebook:

Variable Name | Variable Meaning
------------- | ----------------
salary        | 1990 compensation, $1000s
age           | in years
college       | =1 if attended college
grad          | =1 if attended graduate school
comten        | years with company
ceoten        | years as CEO with company
profits       | 1990 profits, millions
mktval        | market value, end 1990, millions

As we look at these variables, we need to define how we will measure company performance and consider possible limitations in this dataset.

Our primary indicators of company performance will be profit and market value. However, there are several other factors than CEO salary that could influence a company's performance. For example:

* Performance of the CEO's predecessor
* Market environment of a company's industry or sector
* Performance of executive team and employees
* Influence from board of directors
* Prior year profits

To address some of these issues, we will also examine the length of the CEO's tenure. However, a lack of knowledge about external factors will prevent us from making any claims of causality.

## Setup

To begin our analysis, we used the `car` library and loaded the provided data set.

```{r}
library(car)
load("ceo_w203.RData")
```

We take an initial look at our data set.

```{r}
head(CEO)
names(CEO)
str(CEO)
```

There are 185 observations over 8 variables. We notice that `college` and `grad` are dummy variables. The rest of the variables are numeric. The `salary` variable is measured in millions of \$, `profits` and `mktval` are measured in thousands of \$. The `age`, `comten` (years the CEO has been with the company) and `ceoten` (years as CEO with the company) variables are integer values.

## Data Selection

We summarize the data.

```{r}
summary(CEO)
```

It looks like -1 was used to indicate missing data in the mktval and the profits variable. Let's therefore replace -1 by NA:

```{r}
CEO$mktval[CEO$mktval==-1] <- NA
CEO$profits[CEO$profits==-1] <- NA
```

It looks like one row might be duplicated (row 184 and 185). All values - besides age - are identical. The same two rows are aso the only ones, that indicate, that the CEO atended graduate school, but not college! (Data inconsistency?) 

```{r duplicates}
# final 2 values look duplicated

tail(CEO[order(as.numeric(row.names(CEO))),],2)

# potentially synthesize rows into 1 with age value 31.5
```


# Univariate Analysis

The Salary variable has outliers on the high end ==> Log Transformation!

```{r}
hist(CEO$salary, breaks = 20, main = "Histogram of CEO salaries, in 1.000 $" , 
     xlab = NULL)
```


## Profits

The profits variable has negative values and outliers at the high end ==> Log Transformation, possibly omitting the negative values...

```{r}
hist(CEO$profits, breaks = 30, main = "Histogram of Company Profits, in million $" , 
     xlab = NULL)
```

## Market Value

The Market Value variable has outliers on the high end ==> Log Transformation!

```{r}
hist(CEO$mktval, breaks = 20, main = "Histogram of Company Market Value, in million $" , 
     xlab = NULL)
```


## Tranformation

Since all distributions are heavily skewed with outliers to the far right, a logarithmic transformation seems appropriate. For the profits variable we also have to consider omitting all values <= 0 in the transformation and then analysing those values seperately. It probably generally makes sense to assume, that there is a different kind of relationship between negative profits and the CEO salary, than between positive profits and the CEO salary.

First let's check how many profits values actually are zero or negative

```{r}
sum(CEO$profits<=0, na.rm = TRUE)
```

We would be omitting 10 values out of roughly 180, which is less than 6%.

```{r}
CEO$log_salary  = log10(CEO$salary)
CEO$log_profits = log10(CEO$profits)
CEO$log_mktval  = log10(CEO$mktval)

hist(CEO$log_salary, breaks = 20)
hist(CEO$log_profits, breaks = 20)
hist(CEO$log_mktval, breaks = 20)
```

The negative profit values are transformed into NAs. 

The transformed salary and profits variable resemble the normal distribution, while the market value variable still has a minor left skew, but no significant outliers. Logarithmic transformation reduces the skewness of all three variables. 


# Bivariate analysis

## Salary, Market Value and Profits

Let's first check out the linear correlation between the salary and the market value and profits variable. When profits is involved, we only check for positive profits. We do this, so that we can better compare the correlation coefficient with its transformed correspondence.

```{r}
pos_profits = CEO$profits > 0

cor(CEO$profits[pos_profits], CEO$salary[pos_profits], use = "complete.obs")
cor(CEO$mktval, CEO$salary, use = "complete.obs")
cor(CEO$profits[pos_profits], CEO$mktval[pos_profits], use = "complete.obs")
```

```{r}
scatterplotMatrix( ~ salary + profits + mktval, data = CEO, 
 #                reg.line="" , 
                   smoother="",
                   diagonal = "histogram", 
                   main = "Scatterplot Matrix for original data")
```

There is a moderate positive linear correlation between salary and market value as well as salary and profits.

Market value and profits have a very strong linear correlation (> 1).

Let's have a look at the correlation after transformation. 

```{r}
cor(CEO$log_profits, CEO$log_salary, use = "complete.obs")
cor(CEO$log_mktval, CEO$log_salary, use = "complete.obs")
cor(CEO$log_profits, CEO$log_mktval, use = "complete.obs")
```

```{r}
scatterplotMatrix( ~ log_salary + log_profits + log_mktval, data = CEO, 
 #                reg.line="" , 
                   smoother="",
                   diagonal = "histogram", 
                   main = "Scatterplot Matrix for transformed data")
```

After transformation, we can see a stronger relationship between salary and profits as well as market value and profits. The correlation for either pair is close to 0.5 (previously close to 0.4). Due to the nonlinearity of the relationship, the calculated correlation on the original (non transformed) variables, underestimates the actual relationship.

Let's now take a look at the Scatterplot Matrix for the key variables under examination. Note that all data points, where profits is negative, are omitted.

We can see a correlation between 

Does it make sense to even look at those ten data points?

```{r}
scatterplotMatrix( ~ salary[profits <= 0] + profits[profits <= 0] + mktval[profits <= 0], 
                   data = CEO, 
 #                reg.line="" , 
                   smoother="",
                   diagonal = "histogram", 
                   main = "Scatterplot Matrix for negative profit values")
```

# Further considerations

## Weighted profits / market value

Maybe it would be better to weight the profits and market value variables with the time the CEO has been CEO respectively with the company. This way we limit the effect of predecessors policies. 

```{r}
CEO$weighted_profits = CEO$profits * CEO$ceoten
CEO$weighted_mktval = CEO$mktval * CEO$ceoten

cor(CEO$salary, CEO$weighted_profits, use = "complete.obs")
cor(CEO$salary, CEO$weighted_mktval, use = "complete.obs")
cor(CEO$weighted_profits, CEO$weighted_mktval, use = "complete.obs")
```

Since there are comten/ceoten values that are zero, some of the weighted values are now zero. We replace those with NAs before logarithmic transformation, to avoid infintive values. These values will be omitted and this might be justified by arguing, that CEOs who have been with the company for less than a year, do not have a significant effect on the companies profit or market value yet. 


```{r}
CEO$log_weighted_profits = log10(CEO$weighted_profits)
CEO$log_weighted_mktval  = log10(CEO$weighted_mktval)

CEO$log_weighted_profits[CEO$weighted_profits == 0] = NA
CEO$log_weighted_mktval[CEO$weighted_mktval == 0] = NA

cor(CEO$salary, CEO$log_weighted_profits, use = "complete.obs")
cor(CEO$salary, CEO$log_weighted_mktval, use = "complete.obs")
cor(CEO$log_weighted_profits, CEO$log_weighted_mktval, use = "complete.obs")
```

```{r}
hist(CEO$log_weighted_profits)
hist(CEO$log_weighted_mktval)
```

Let's draw a scatterplot matrix for those weighted variables.

```{r}
scatterplotMatrix( ~ log_salary + log_weighted_profits + log_weighted_mktval, 
                   data = CEO, 
#                 reg.line="" , 
                   smoother="",
                   diagonal = "histogram", 
                   main = "Scatterplot Matrix for weighted profits / market value")
```

The correlation between log_salary and log_weighted_profits respectively log_salary and log_weighted_mktval don't seem stronger than their unweighted counterparts. 

(However, the correlation between log_weighted_profits and log_weighted_mktval look stronger than between the unweighted versions. This possibly accounts for the intuitive assumption, that a CEOs achieved profit has a higher effect on the market value, the longer he has been CEO.)

## Age factor

```{r}
hist(CEO$age)
```

There is new significant skew in the age variable.

Let's check if there is a correlation between age and salary. It seems natural to assume that their might be a correlation between those two variables.

```{r}
cor(CEO$age, CEO$salary)
```



There seems to be no significant linear relationship between age and salary. This can also be seen in the scatterplot.

```{r}
plot(CEO$age, CEO$salary)
```

## Education factor

Let's examine, if there is a linear correlation between salary and education.

Let's add both education variables to create one variable that indicates the CEOs overall education and check the correlation (does checking the correlation really make sense here?)

```{r}
CEO$educ = CEO$college + CEO$grad
cor(CEO$educ, CEO$salary)
```

There seems to be no significant linear correlation. Let's look at the boxplots for all education levels.

```{r}
educ_bin = cut(CEO$educ, breaks = 3, labels = 
      c("No College", "Attended College", "Attended Grad School"))
summary(educ_bin)
```

```{r}
boxplot(salary ~ educ_bin, data = CEO,
        main = "Salary by College Attendance",
        ylab = "salary in 1000 $s")
```

Since there are only 5 data points of CEOs with no college education, the "No College" boxplot has no significance and shall not be discussed further. The other two boxplots reveal that there is only very little difference in the salary distribution between CEOs that attended College and those that attended Grad School.

## Seniority factor

```{r}
hist(CEO$ceoten)
hist(CEO$comten)
hist(log(CEO$ceoten))
``` 

The ceoten variable (amount of years the CEO has been in office within the company) is skewed. Use transformation?????

Finally, let's check out, if seniority and salary correlate in some way.

```{r}
cor(CEO$comten, CEO$salary)
cor(CEO$ceoten, CEO$salary)

CEO$log_ceoten = log(CEO$ceoten)
CEO$log_ceoten[CEO$ceoten == 0] <- NA

cor(CEO$log_ceoten, CEO$log_salary, use = "complete.obs")

```

```{r}
scatterplotMatrix( ~ salary + log_salary + ceoten + log_ceoten + comten,  
                   data = CEO, 
#                 reg.line="" , 
                   smoother="",
                   diagonal = "histogram", 
                   main = "Scatterplot Matrix Seniority")
```

```{r}
scatterplotMatrix( ~ ceoten + comten + mktval + profits,  
                   data = CEO, 
#                 reg.line="" , 
                   smoother="",
                   diagonal = "histogram", 
                   main = "Scatterplot Matrix Seniority")
```


